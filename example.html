<!DOCTYPE html>
<html>
    <head>
        <title>Functionality without compromises</title>
        <meta charset="windows-1252"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"/>
        <script src="globalRequestEvents.js"></script>
        <script type="module" src="httpHiddenMethod.js"></script>
        <script type="module" src="tasks.js"></script>
        <script type="module" src="hashtracker.js"></script>
        <script type="module" src="urlRewriter.js"></script>
    </head>
    <body>
        <div class="container">
            <h1 id="title">Functionality without compromises</h1>
            <form>
                <div class="form-group">
                    <label for="appLog">App Log</label>
                    <textarea id="appLog" rows="10" readonly="readonly" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-danger float-right" onclick="clearLog()">Clear Log</button>
                </div>
                <div class="form-group">
                    <h2>Document scope fetch listeners</h2>
                    <p>Add fetch events attached to the document object.</p>
                    <p>
                        <code>document.addEventListener("fetchStart", fnListener);</code>
                    </p>
                    
                    <button type="button" onclick="fetchUrl('GET', 'data.json')" class="btn btn-primary">
                        Fetch numbers
                    </button>
                    
                    <button type="button" onclick="fetchUrl('GET', 'example.json')" class="btn btn-primary">
                        Fetch non existing data
                    </button>
                    <br/>
                    <br/>
                    <table class="table table-sm">
                        <caption>Available events</caption>
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Event Detail Properties</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>fetchStart</code></td>
                                <td><code>event.detail.url, event.detail.init</code></td>
                            </tr>
                            <tr>
                                <td><code>fetchComplete</code></td>
                                <td><code>event.detail.url, event.detail.init, event.detail.response</code></td>
                            </tr>
                            <tr>
                                <td><code>fetchFail</code></td>
                                <td><code>event.detail.url, event.detail.init, event.detail.error</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-group">
                    <h2>Hidden Method Example</h2>
                    <p>Used a hidden method param when an HTTP method is now allowed in a host or application (maybe because of security policies not controlled by you).</p>
                    <p>The HTPP method is converted to POST and a method param is used instead.</p>
                    <button type="button" onclick="fetchUrl('DELETE', 'data.json')" class="btn btn-primary">
                        Fetch with PUT method.
                    </button>
                </div>
                <div class="form-group">
                    <h2>Hash Location Example</h2>
                    <p>
                        Call functions when the hash location of the windows is changed.
                    </p>
                    <p>
                        <code>hashTracker.given("#/init").then(fn);</code>
                    </p>
                    <a href="#/init" class="btn btn-success">Init</a>
                    <a href="#/hello/world" class="btn btn-success">Hello</a>
                </div>
            </form>
        </div>
        <script type="module">
            import hashTracker from "./hashtracker.js";
            
            import urlRewriter from "./urlRewriter.js";
            
            function log(text) {
                if(document.getElementById("appLog").value.length !== 0) {
                    document.getElementById("appLog").value+="\n";
                }
                document.getElementById("appLog").value+=text;
            }
            
            document.addEventListener("fetchStart", (event) => {
                log("Fetch start. Url: ["+event.detail.url+"]. Method: ["+event.detail.init.method+"].");
            });
            document.addEventListener("fetchComplete", () => {
                log("Fetch complete");
            });
            document.addEventListener("fetchFail", () => {
                log("Fetch fail");
            });
            hashTracker.given("#/init").then(()=> {
                document.getElementById("title").innerHTML="Init";
            });
            hashTracker.given("#/hello/(.+)").then((matchResult)=> {
                document.getElementById("title").innerHTML="Hello, "+matchResult[1]+"!";
            });
            urlRewriter.baseUrl="";
            hashTracker.processCurrent();
            
            window.fetchUrl=function(method, url) {
                window.fetch(url, {
                    method: method
                }).then(response => {
                    if(response.status === 200) {
                        response.json().then(data => {
                            log("Data response: "+data);
                        });
                    }
                });
            }
            
            window.clearLog=function(){
                document.getElementById("appLog").value="";
            };
        </script>
    </body>
</html>
